<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Checkout</title>
    <link rel="shortcut icon" th:href="@{/images/favicon.ico}" type="image/x-icon">
    <link rel="stylesheet" th:href="@{/css/frontoffice.css}">

    <script>
        function toggleCartaoCampos() {
            var formaPagamento = document.getElementById("formaPagamento").value;
            var cartaoCampos = document.getElementById("cartaoCampos");
            var parcelasDiv = document.getElementById("parcelasDiv");
            var parcelasSelect = document.getElementById("parcelas");

            var numeroCartao = document.getElementById("numeroCartao");
            var codigoVerificador = document.getElementById("codigoVerificador");
            var nomeCompleto = document.getElementById("nomeCompleto");
            var dataVencimento = document.getElementById("dataVencimento");

            if (formaPagamento === "CREDITO" || formaPagamento === "DEBITO") {
                cartaoCampos.style.display = "block";
            } else {
                cartaoCampos.style.display = "none";
                numeroCartao.value = "";
                codigoVerificador.value = "";
                nomeCompleto.value = "";
                dataVencimento.value = "";
            }

            if (formaPagamento === "CREDITO") {
                parcelasDiv.style.display = "block";
            } else {
                parcelasDiv.style.display = "none";
                parcelasSelect.value = "";
            }
        }

        function formatarNumeroCartao() {
            var input = document.getElementById("numeroCartao");
            var numeroCartao = input.value.replace(/\D/g, '');
            numeroCartao = numeroCartao.match(/.{1,4}/g);
            if (numeroCartao) {
                input.value = numeroCartao.join(' ');
            }
        }

        window.onload = function () {
            toggleCartaoCampos();
        };
    </script>

</head>
<body>
<header>
    <div th:replace="fragments/header :: header"></div>
    <button class="btn-voltar" onclick="window.location.href='/'" type="button"><img
            th:src="@{/images/seta.png}"></button>
</header>

<main>
    <section class="checkout-container">
        <div class="left-group">
            <div class="endereco-checkout">
                <label for="endereco-faturamento">Endereço de faturamento:</label>
                <select class="select-field" id="endereco-faturamento" required th:field="*{enderecoFaturamento}">
                    <option th:each="endereco : ${enderecoFaturamento}"
                            th:selected="${endereco.id == endereco.id}"
                            th:text="${endereco.logradouro + ', ' + endereco.numero + ' - ' + endereco.bairro}"
                            th:value="${endereco.id}">
                    </option>
                </select>
            </div>
            <div class="endereco-checkout">
                <label for="endereco-entrega">Endereço de entrega:</label>
                <select class="select-field" id="endereco-entrega" required th:field="*{enderecoEntrega}">
                    <option th:each="endereco : ${enderecoEntrega}"
                            th:value="${endereco.id}"
                            th:text="${endereco.logradouro + ', ' + endereco.numero + ' - ' + endereco.bairro}"
                            th:selected="${endereco.id == enderecoPadrao.id}">
                    </option>
                </select>
            </div>
            <div class="pagamento-checkout">
                <label for="formaPagamento">Forma de Pagamento:</label>
                <select class="select-field" id="formaPagamento" onchange="toggleCartaoCampos()" required
                        th:field="*{carrinho.formaPagamento}">
                    <option class="option-select" value="BOLETO">Boleto Bancário</option>
                    <option value="CREDITO" class="option-select">Cartão de Crédito</option>
                    <option value="DEBITO" class="option-select">Cartão de Débito</option>
                </select>
            </div>

            <div id="cartaoCampos" style="display: none;">
                <div>
                    <label for="numeroCartao">Número do Cartão:</label>
                    <input id="numeroCartao" maxlength="19" oninput="formatarNumeroCartao()" placeholder="0000 0000 0000 0000"
                           required type="text">
                </div>
                <div>
                    <label for="codigoVerificador">Código Verificador (CVV):</label>
                    <input id="codigoVerificador" maxlength="3" pattern="\d{3}" placeholder="123" required type="text">
                </div>
                <div>
                    <label for="nomeCompleto">Nome Completo:</label>
                    <input id="nomeCompleto" maxlength="40" placeholder="Nome Completo" required type="text">
                </div>
                <div>
                    <label for="dataVencimento">Data de Vencimento:</label>
                    <input id="dataVencimento" required type="month">
                </div>
                <div id="parcelasDiv" style="display: none;">
                    <label for="parcelas">Quantidade de Parcelas:</label>
                    <select id="parcelas">
                        <option value="1">1x</option>
                        <option value="2">2x</option>
                        <option value="3">3x</option>
                        <option value="4">4x</option>
                        <option value="5">5x</option>
                        <option value="6">6x</option>
                        <option value="7">7x</option>
                        <option value="8">8x</option>
                        <option value="9">9x</option>
                        <option value="10">10x</option>
                    </select>
                </div>
            </div>

            <div class="revisao-itens">
                <div class="card-row">
                    <div th:each="item : ${carrinho.itens}">
                        <div class="desc-produto-row">
                            <div th:each="imagem : ${item.produto.imagens}">
                                <img alt="Imagem do Produto - ${item.produto.nome}" class="imagem-produto-carrinho"
                                     th:src="@{/imagem/{id}(id=${imagem.id})}"/>
                            </div>

                            <div class="produto-carrinho">
                                <p class="info-produto"><strong>Produto:</strong></p>
                                <span th:text="${item.produto.nome}"></span>
                            </div>

                            <div class="quantidade-carrinho">
                                <p class="info-produto"><strong>Quantidade:</strong></p>
                                <div class="botao-row">
                                    <form th:action="@{/carrinho/diminuirQuantidade}" method="post">
                                        <input type="hidden" name="produtoId" th:value="${item.produto.id}">
                                        <button type="submit" class="btn-decrementar" onclick="alterarQuantidade(-1)">-</button>
                                    </form>
                                    <span class="span-carrinho" th:text="${item.quantidade}"></span>
                                    <form th:action="@{/carrinho/aumentarQuantidade}" method="post">
                                        <input type="hidden" name="produtoId" th:value="${item.produto.id}">
                                        <button type="submit" class="btn-incrementar" onclick="alterarQuantidade(1)">+</button>
                                    </form>
                                </div>
                            </div>

                            <div class="preco-carrinho">
                                <p class="info-produto"><strong>Preço:</strong></p>
                                <span th:text="'R$ ' + ${#numbers.formatDecimal(item.valorItem, 1, 2)}"></span>
                            </div>

                            <form th:action="@{/carrinho/removerProduto}" method="post" onsubmit="return confirmChange()" class="botao-remover-carrinho-container">
                                <input type="hidden" name="produtoId" th:value="${item.produto.id}">
                                <button type="submit" class="botao-remover-carrinho" aria-label="Remover produto do carrinho"><img th:src="@{../images/lixeira.png}" alt="Remover produto"></button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="right-group">
            <div class="finalizar">
                <h2 class="form-title">Resumo do Pedido</h2>
                <div class="finalizar-row">
                    <p class="valor-produto">Subtotal</p>
                    <span th:text="'R$ ' + ${#numbers.formatDecimal(carrinho.valorTotal, 1, 2)}"></span>
                </div>
                <div class="finalizar-row">
                    <p class="valor-frete">Frete:</p>
                    <span class="valor-frete" th:text="'R$ ' + ${#numbers.formatDecimal(carrinho.frete, 1, 2)}"></span>
                </div>
                <div class="finalizar-row">
                    <strong>Total:</strong>
                    <span th:text="'R$ ' + ${#numbers.formatDecimal(carrinho.valorComFrete, 1, 2)}"></span>
                </div>
                <button style="background-color: #5C0A0A; border-radius: 1em; height: 4em; width: 33em; margin-top: 2em;" aria-label="Finalizar Compra">
                    <p class="finalizar-compra" style="font-size: 1.5em; color: white;">Finalizar Compra</p>
                </button>
            </div>
        </div>
    </section>
</main>

<footer>
    <div th:replace="fragments/footer :: footer"></div>
</footer>

</body>
</html>